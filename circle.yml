general:
  artifacts:
    - "coverage"

machine:
  environment:
    PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"
  node:
    version: 6.10.2

dependencies:
  override:
    - yarn
  cache_directories:
    - ~/.cache/yarn

test:
  pre:
    - gcloud --quiet components install beta
    - gcloud --quiet beta emulators datastore start --no-legacy 
    - curl --retry 10 --retry-delay 2 -v http://localhost:8081 # make sure the Datastore emulator is ready
  override:
    - yarn validate