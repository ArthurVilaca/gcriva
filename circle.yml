general:
  artifacts:
    - "coverage"

machine:
  environment:
    PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"
  post:
    - nvm use && nvm alias default $(nvm current)
dependencies:
  override:
    - yarn
  cache_directories:
    - ~/.cache/yarn

test:
  pre:
    - gcloud beta emulators datastore start --no-legacy 
    - curl --retry 10 --retry-delay 5 -v http://localhost:8081 # make sure the Datastore emulator is ready
  override:
    - yarn validate